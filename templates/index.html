<!DOCTYPE html>
<html>
<head>
    <title>Password Security Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="dashboard">
    <h1> Password Security Analyzer</h1>

    <form method="POST" enctype="multipart/form-data">
        <input type="text" name="password" id="passwordInput"
               placeholder="Enter password" oninput="calculateEntropy()" required>
        <input type="file" name="wordlist" accept=".txt">
        <button type="submit">Analyze</button>
    </form>

    <!-- Real-Time Entropy Meter -->
    <div class="card">
        <strong>Real-Time Entropy Meter</strong>
        <div class="entropy-bar">
            <div class="entropy-fill" id="entropyFill"></div>
        </div>
        <div id="entropyText"></div>
    </div>

    {% if result %}
    <!-- Hash Results -->
    <div class="card">
        <p><strong>SHA256:</strong> {{ result.sha }}</p>
        <p><strong>Salted SHA256:</strong> {{ result.salted }}</p>
        <p><strong>bcrypt:</strong> {{ result.bcrypt }}</p>
        <p><strong>Entropy:</strong> {{ result.entropy }} bits</p>
        <p><strong>Estimated Crack Time:</strong> {{ result.crack_time }}</p>
    </div>

    <!-- GPU vs CPU -->
    <div class="card">
        <strong>CPU vs GPU Crack Time:</strong>
        <p>CPU: {{ result.gpu_result.cpu_time | round(2) }} sec</p>
        <p>GPU: {{ result.gpu_result.gpu_time | round(2) }} sec</p>
    </div>

    <!-- Dictionary Attack Result -->
    <div class="card">
        <strong>Dictionary Attack Simulation:</strong>
        {% if result.attack_result.found %}
            <p style="color:lime;">Password cracked: {{ result.attack_result.password }}</p>
        {% else %}
            <p style="color:red;">Not found in dictionary.</p>
        {% endif %}
        <p>Total Attempts: {{ result.attack_result.attempts }}</p>
    </div>

    <!-- Attempt Growth Graph -->
    <div class="card">
        <strong>Brute Force Attempt Growth Graph</strong>
        <img src="data:image/png;base64,{{ result.graph }}" style="width:100%;">
    </div>

    <!-- Simulated Attack Animation -->
    <div class="card">
        <strong>Simulated Attack:</strong>
        <div class="attack-animation" id="attackAnimation"></div>
    </div>
    {% endif %}

</div>

<script>
function calculateEntropy() {
    let password = document.getElementById("passwordInput").value;
    let charset = 0;
    if(/[a-z]/.test(password)) charset += 26;
    if(/[A-Z]/.test(password)) charset += 26;
    if(/[0-9]/.test(password)) charset += 10;
    if(/[^a-zA-Z0-9]/.test(password)) charset += 32;

    let entropy = password.length * Math.log2(charset || 1);
    let percent = Math.min(entropy*2, 100);

    let fill = document.getElementById("entropyFill");
    fill.style.width = percent + "%";

    if(entropy < 40) fill.style.background = "red";
    else if(entropy < 60) fill.style.background = "orange";
    else fill.style.background = "lime";

    document.getElementById("entropyText").innerText = entropy.toFixed(2) + " bits";
}

// Simulated Attack Animation
{% if result %}
let animation = document.getElementById("attackAnimation");
let words = ["123456","password","admin","qwerty","letmein"];
let i = 0;
let interval = setInterval(() => {
    animation.innerText = "Trying: " + words[i];
    i++;
    if(i >= words.length){
        animation.innerText = "Password cracked!";
        clearInterval(interval);
    }
}, 400);
{% endif %}
</script>

</body>
</html>